---
title: "Shiny Server Deployment"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Shiny Server Deployment}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Overview

ReviewR is designed to support multiple concurrent users when deployed using Shiny Server. In server deployments, users will access ReviewR directly through a web browser without requiring a local R installation. When deployed on a centralized server an instance of ReviewR will be served to each connecting user in distinct R sessions allowing multiple participants to simultaneously connect to patient data and submit chart abstraction information. 

## Installation

First users must deploy and secure their installation of Shiny Server with a stable https URL. ReviewR should work with both [Open Source Shiny Server](https://rstudio.com/products/shiny/download-server/) as well as [Shiny Server Pro](https://rstudio.com/products/shiny-server-pro/). While deploying and configuring Shiny Server is outside the scope of this vignette, links to instructions for setting up and securing the Open Source version of Shiny Server on servers running Ubuntu 18.04 can be found in the <a href="#prerequisites">Prerequisites</a> section below.

### Prerequisites 
* [Shiny Server: Quick Start Guide](https://support.rstudio.com/hc/en-us/articles/360011458854-Shiny-Server-Quick-Start-Installation-and-Configuration)
* [Shiny Server: Running with a Proxy](https://support.rstudio.com/hc/en-us/articles/213733868-Running-Shiny-Server-with-a-Proxy)
* [Let's Encrypt Getting Started](https://letsencrypt.org/getting-started/)
* [Secure NGINX with Let's Encrypt](https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-18-04)

*Note: Prerequisites assume a server running Ubuntu 18.04.* 

### Shiny Server

1. Install the ReviewR package as a root user in order to ensure your system R package library has all of the required dependencies
    + From a **bash terminal**, run:
        ```{bash eval=FALSE}
        # Start R in an interactive root terminal
        sudo -i R
        ```
    *This will open an interactive R console as a root user*
    + From the **R console** that opens, run:
      ```{r eval=FALSE}
      # install.packages('devtools')
      devtools::install_github('thewileylab/ReviewR')
      ```
2. Next, fork the ReviewR repository into the Shiny Server directory (`/srv/shiny-server`) with the `usethis` package. Using the same **R console** from above: 
    ```{r eval=FALSE}
    # install.packages('usethis')
    usethis::create_from_github(repo_spec = 'thewileylab/ReviewR', destdir = '/srv/shiny-server')
    ```
    *This step will fork the most recent version of the ReviewR package from GitHub which includes additional files and development tools not built directly into the package. This includes an `app.R` file which Shiny Server will need to deploy ReviewR. By default, Shiny Server will host all applications that are placed in `/srv/shiny-server`*

That's it! ReviewR can now be accessed from your browser at https://your.shinyserver.url/ReviewR

### Docker

ReviewR also ships with a Dockerfile, simplifying the deployment process. The Dockerfile will install R, Shiny, and all the necessary dependencies needed to run ReviewR. To start:

1. Fork the ReviewR repository to the home directory of your server. This can be done from the **R console** with the `usethis` package: 
    ```{r eval=FALSE}
    # install.packages('usethis')
    usethis::create_from_github(repo_spec = 'thewileylab/ReviewR', destdir = '~/')
    ``` 
2. Using the **bash terminal**, run:
    ```{bash eval=FALSE}
    cd ~/ReviewR
    docker build --tag reviewr:latest .
    docker run --publish 1410:1410 --detach --name ReviewR reviewr:latest
    ```

That's it! ReviewR can now be accessed from your browser at http://your.shinyserver.ipaddress:1410 . In order to encrypt this connection, be sure to reverse proxy port 1410 to your server's URL.